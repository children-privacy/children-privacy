# AgeRating

## App downloader

### Setup
1. Install the [PlaystoreDownloader](https://github.com/ClaudiuGeorgiu/PlaystoreDownloader)
2. Copy scripts into the PlaystoreDownloader folder

### Usage
* Make sure the configuration file is updated according to describtion in the [configuration](https://github.com/ClaudiuGeorgiu/PlaystoreDownloader#-configuration)
* Update the path of folder `Downloads` in `app_review_downloader.py`
* Run in command line 
```Python
$ python app_downloader.py [-h] [-s STORE] [-l APP_LIST] [-c CATEGORY]
```

#### Available parameters

* `-s` is the app store, 'google' = Google Play store, 'apkpure' = apkpure.com. Default = 'google'.
* `-l` is the app list generated by ```scraper_app_list.js```.
* `-c` is the category of apps. Available categories are listed below.
```
APPLICATION = 'newly released apps',            NEW_FAMILY = 'newly released family apps',
ANDROID_WEAR = 'ANDROID_WEAR',                  ART_AND_DESIGN = 'ART_AND_DESIGN',                      
AUTO_AND_VEHICLES = 'AUTO_AND_VEHICLES',        BEAUTY = 'BEAUTY',                                     
BOOKS_AND_REFERENCE = 'BOOKS_AND_REFERENCE',    BUSINESS = 'BUSINESS',                                  
COMICS = 'COMICS',                              COMMUNICATION = 'COMMUNICATION',                        
DATING = 'DATING',                              EDUCATION = 'EDUCATION',                                
ENTERTAINMENT = 'ENTERTAINMENT',                EVENTS = 'EVENTS',                                      
FINANCE = 'FINANCE',                            FOOD_AND_DRINK = 'FOOD_AND_DRINK',                      
HEALTH_AND_FITNESS = 'HEALTH_AND_FITNESS',      HOUSE_AND_HOME = 'HOUSE_AND_HOME',                      
LIBRARIES_AND_DEMO = 'LIBRARIES_AND_DEMO',      LIFESTYLE = 'LIFESTYLE',                                
MAPS_AND_NAVIGATION = 'MAPS_AND_NAVIGATION',    MEDICAL = 'MEDICAL',                                    
MUSIC_AND_AUDIO = 'MUSIC_AND_AUDIO',            NEWS_AND_MAGAZINES = 'NEWS_AND_MAGAZINES',              
PARENTING = 'PARENTING',                        PERSONALIZATION = 'PERSONALIZATION',                    
PHOTOGRAPHY = 'PHOTOGRAPHY',                    PRODUCTIVITY = 'PRODUCTIVITY',                          
SHOPPING = 'SHOPPING',                          SOCIAL = 'SOCIAL',                                      
SPORTS = 'SPORTS',                              TOOLS = 'TOOLS',                                        
TRAVEL_AND_LOCAL = 'TRAVEL_AND_LOCAL',          VIDEO_PLAYERS = 'VIDEO_PLAYERS',                        
WEATHER = 'WEATHER',                            GAME = 'GAME',                                          
GAME_ACTION = 'GAME_ACTION',                    GAME_ADVENTURE = 'GAME_ADVENTURE',                      
GAME_ARCADE = 'GAME_ARCADE',                    GAME_BOARD = 'GAME_BOARD',                              
GAME_CARD = 'GAME_CARD',                        GAME_CASINO = 'GAME_CASINO',                            
GAME_CASUAL = 'GAME_CASUAL',                    GAME_EDUCATIONAL = 'GAME_EDUCATIONAL',                  
GAME_MUSIC = 'GAME_MUSIC',                      GAME_PUZZLE = 'GAME_PUZZLE',                            
GAME_RACING = 'GAME_RACING',                    GAME_ROLE_PLAYING = 'GAME_ROLE_PLAYING',                
GAME_SIMULATION = 'GAME_SIMULATION',            GAME_SPORTS = 'GAME_SPORTS',                            
GAME_STRATEGY = 'GAME_STRATEGY',                GAME_TRIVIA = 'GAME_TRIVIA',                            
GAME_WORD = 'GAME_WORD',                        FAMILY = 'FAMILY',                                      
FAMILY_ACTION = 'FAMILY_ACTION',                FAMILY_BRAINGAMES = 'FAMILY_BRAINGAMES',               
FAMILY_CREATE = 'FAMILY_CREATE',                FAMILY_EDUCATION = 'FAMILY_EDUCATION',                  
FAMILY_MUSICVIDEO = 'FAMILY_MUSICVIDEO',        FAMILY_PRETEND = 'FAMILY_PRETEND'
```
* By default, the number of apps is set as 200, the number of reviews is set as 3000, the type of apps are top selling free (TOP_FREE)
#### Output paths
* Apk files: ./Downloads/APKs
* App list: ./Downloads/App_list
* Reviews: ./Downloads/Reviews

#### Example 1
* To download top free apps and reviews from google store in each category listed in the ```App_downloader.categories```: 
```Python
$ python app_downloader.py
```
#### Example 2
* To download apps from google store accoring to an app list:
```Python
$ python app_downloader.py -l path_to_list
```
#### Example 3
* To download apps from APKpure according to an app list:
```Python
$ python app_downloader.py -s apkpure -l path_to_list
```
#### Example 4
* To download apps from category ```FAMILY```:
```Python
$ python app_downloader.py -c FAMILY
```
## Comments extractor
### Usage
* Run in command line 
```Python
$ python comments_extractor.py -f FOLDERNAME [-r RATING]
```
#### Parameter
* `-f` is the folder name where the downloaded apps and reviews are stored, e.g., `Education_11Feb2021_184`.
* `-r` is the rating of comments that will be extracted (1-5). Default = 1.
#### Example
* To extract all the reviews rated as `2` that stored in the folder ".\Downloads\Entertainment_11Feb2021_134":
```Python
$ python comments_extractor.py -f Entertainment_11Feb2021_134 -r 2
```
#### Output
* Path: .\Downloads\Entertainment_11Feb2021_134\comment.txt
* One comment per line

## BTM
### BTM training
#### Usage
* Install [BTM package](https://github.com/markoarnauto/biterm)
* Set the path in `btm_training.py`
* Run in command line
```Python
$ python btm_training.py [-n N_REVIEWS] [-t N_TOPICS] [-s CHUNK_SIZE] [-o OUTPUT_FILENAME]
```
#### Parameters
* `-n` is the number of reviews that are randomly selected as training samples. Default = 1000. If n = -1, all reviews will be selected.
* `-t` is the number of topics/clusters will be assigned. Default = 20.
* `-s` is the number of samples (a chunck) will be input to online training in each round.
* `-o` is the root name of output files. Default = "btm".
#### Examples
* To train a BTM model with 3,000 reviews and output into 30 topics:
```Python
$ python btm_training.py -n 3000 -t 30
```
The vocabulary will be output as `btm_3000_30.vcb`. The trained model will be output as `btm_3000_30.mdl`.

## Static Analysis

### Install
* Install [AndroidGuard](https://github.com/androguard/androguard)
* Install [LiteRadar](https://github.com/pkumza/LiteRadar). Note that LiteRadar uses Python2, so there could be some bugs in Python3.
### Permission & third-party lib analysis
1. Run static analysis
```Python
$ python static_analyzer.py apk_folder
```
Outputï¼š```apk_folder/Static_results/package_name.json```: json files containing permission and tracker results.
2. Summarize the static results
```Python
$ python summarize_static_analysis top_apk_folder
```
Output: ```top_apk_folder/static_result.txt```: txt file with summarized data seperated by '||', which could be easily imported to Excel.
### VirusTotal
1. Setup the ```api_key```
2. Upload apk and get reports from VirusTotal. (You may need to run this for several times to collect all reports)
```Python
$ python virus_total.py top_apk_folder
```
Output: ```top_apk_folder/vt_restuls.txt```: txt file containing number of engines that detected malware and the package name of corrusponding apk, seperated by '||'.

## Dynamic Analysis
### Setup
1. Install [Lumen](https://play.google.com/store/apps/details?id=edu.berkeley.icsi.haystack) on a rooted Android phone. (Lumen does not require root, but we need to root a device to pull data from it)
### Lumen
1. Get the device ID
```Bash
$ adb devices
```
2. Run Lumen testing
```Python
$ python lumen_script.py apk_folder device_id
```
Output: extract Lumen data after testing every 10 apps as ```apk_folder/lumen_xx.db```

3. Summarize data 
```Python
$ python summarize_lumen_result.py top_apk_folder
```
Output: ```lumen_privacy.txt``` and ```lumen_flow.txt```
